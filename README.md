# DexYCB Right-Hand Dataset (Processed by DexPilot)

This repository contains the **right-hand subset** of the DexYCB dataset, exported into lightweight **per-frame `.pkl`** files. These files are designed for efficient loading and processing in robot teleoperation and retargeting pipelines (e.g., DexPilot).

---

## Dataset Structure

Example layout under the `right/` folder:

```
right/
  └── 20200709-subject-01/
        ├── 20200709_141754/
        │     ├── meta/        # human hand annotations
        │     │     ├── 0000.pkl
        │     │     ├── 0001.pkl
        │     │     └── ...
        │     └── dex_meta/    # retargeted robot joint trajectories (output)
        │           ├── 0000.pkl
        │           ├── 0001.pkl
        │           └── ...
        ├── 20200709_141841/
        └── 20200709_142123/
```

* **`meta/`**: Contains human hand and object data (original dataset as https://github.com/Shurui8860/dexYCB_dataloader/tree/master/dexYCB_dataset).
* **`dex_meta/`**: Contains robot joint trajectories after retargeting, generated by `processor.py`.

---

## Contents of `.pkl` Files

Each **per-frame `.pkl`** in `meta/` stores a dictionary with:

| Field          |  Shape | Type            | Units         | Description                                                                                          |
| -------------- | :----: | --------------- | ------------- | ---------------------------------------------------------------------------------------------------- |
| `seqName`      |    –   | `str`           | –             | Subject/sequence identifier.                                                                         |
| `side`         |    –   | `str`           | –             | Hand side: `left` or `right`.                                                                        |
| `frame`        |    –   | `int`           | –             | Zero-based frame index within the sequence.                                                          |
| `order`        |    –   | `str`           | –             | Joint indexing convention used for `handJoints3D` (e.g., `ho3d`, `mano`).                            |
| `handPose`     |  (48,) | `numpy.ndarray` | radians       | MANO pose parameters: **3** for global wrist rotation + **15 × 3** axis-angle for articulated joints. |
| `handTrans`    |  (3,)  | `numpy.ndarray` | meters        | Global hand translation (MANO wrist/root) in **world coordinates**.                                  |
| `handBeta`     |  (10,) | `numpy.ndarray` | –             | MANO shape coefficients.                                                  |
| `objRot`       |  (3,)  | `numpy.ndarray` | radians (vec) | Object rotation as **axis-angle** (rotation vector).                                                 |
| `objTrans`     |  (3,)  | `numpy.ndarray` | meters        | Object translation in **world coordinates**.                                                         |
| `objName`      |    –   | `str`           | –             | YCB object identifier.                                                                               |
| `handJoints3D` | (21,3) | `numpy.ndarray` | meters        | 3D hand joints in **world coordinates** (HO3D-21 order when `order: ho3d`).                          | 


Example (`20200709-subject-01/20200709_141754/meta/0014.pkl`):

```python
{
  "seqName": "/mnt/d/dex-ycb-toolkit-master/data/20200709-subject-01/20200709_141754",
  "handPose": array([ 2.6289,  1.4164, -0.9719,  0.2212, -0.3989,  0.1346, ...,
                      -0.1937,  0.1097], dtype=float32),  # length 48
  "handTrans": array([0.3751, 0.1860, 0.6963], dtype=float32),
  "handBeta": array([ 0.6994, -0.1691, -0.8955, -0.0976,  0.0775,
                       0.3363, -0.0555,  0.5249, -0.3867, -0.0013], dtype=float32),
  "objRot": array([ 1.3147, -0.5410,  0.5343]),
  "objTrans": array([...]),         # object translation vector
  "objName": "bleach_cleanser",     # object identity
  "handJoints3D": array([[x,y,z], ..., [x,y,z]], dtype=float32),  # shape (21,3)
  "side": "right",
  "frame": "0014",
  "order": "ho3d"
}

```

The **retargeted `.pkl` files** in `dex_meta/` contain:

```python
{
  "dummy_x_translation_joint": float,
  "dummy_y_translation_joint": float,
  "dummy_z_translation_joint": float,
  "dummy_x_rotation_joint": float,
  "dummy_y_rotation_joint": float,
  "dummy_z_rotation_joint": float,

  "r_f_joint1_1": float,
  "r_f_joint1_2": float,
  ...
  "r_f_joint5_4": float
}
```

Example (`20200709-subject-01/20200709_141754/dex_meta/0014.pkl`):

```python
{
  "dummy_x_translation_joint": 0.0001,
  "dummy_y_translation_joint": -0.0023,
  "dummy_z_translation_joint": 0.5271,
  "dummy_x_rotation_joint": 0.0012,
  "dummy_y_rotation_joint": -0.0008,
  "dummy_z_rotation_joint": 0.0034,

  "r_f_joint1_1": -0.052,
  "r_f_joint1_2":  0.134,
  "r_f_joint1_3":  0.241,
  "r_f_joint1_4":  0.058,
  ...
  "r_f_joint5_4":  0.143
}
```

where each key is a robot joint name and the value is the corresponding joint angle at that frame.

---

## Data Processing Pipeline

Processing is handled by the `Processor` class (`processor.py`):

1. **Load input sequence**

   * Reads all `.pkl` files under `<seq>/meta/` using `DataLoader`.
   * Converts HO3D joint order → MANO order if required.

2. **Compute trajectory**

   * Runs the SeqRetargeting optimizer on each frame.
   * Produces a robot joint trajectory of shape `(T, dof)`.

3. **Write outputs**

   * Saves per-frame `.pkl` files into `<seq>/dex_meta/`.

---

##  Config File (`config.yaml`)

A typical `config.yaml` contains three main sections:

```yaml
robot:
  urdf_path: dexrobot_urdf/urdf/dexhand021_right_flyingbase.urdf
  finger_tip_link_names:
    - r_f_link1_tip
    - r_f_link2_tip
    - r_f_link3_tip
    - r_f_link4_tip
    - r_f_link5_tip
  wrist_link_name: r_p_link0

filter:
  dt: 0.066666666 # timestep (s), default 1/15
  fc_hz: 6.0      # cutoff frequency for LP filter

optimizer:
  scale: 2.0
  huber_delta: 0.03
  norm_delta: 0.004
  project_dist: 0.03
  escape_dist: 0.05
  eta1: 0.0001
  eta2: 0.03

warm_start: true
```
---

## Typical Usage

### Process all subjects

```bash
python vision2dex/processor/processor.py
```

By default, it loads `config.yaml`, prints a summary, and processes **all subjects under `right/`** into `dex_meta/`.

### Show one sequence data

```bash
python vision2dex/processor/data_loader.py right/20200709-subject-01/20200709_141841 --order ho3d
```

This prints a summary of the sequence (joint array shapes, frame count, etc).

### Typical pipeline

```python
from vision2dex.processor.processor import Processor

proc = Processor().from_yaml("vision2dex/processor/config.yaml")
proc.print_summary()
proc.process_subject("right/20200709-subject-01", order="ho3d", out_subdir="dex_meta")
```

